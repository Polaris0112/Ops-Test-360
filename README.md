## <center>运维机试题</center>

1.如果现在给你 50 台服务器，你会如何管理？

基本要求

* 服务器均为Ubuntu
*  运行的应用主要为Nginx、MySQL、Redis、Python等
* 请简述你的主要思路，并列举一些你常用的工具链
* 独立完成，提供代码的 GitHub 仓库链接即可

***

## 回答

这次回答分了四种方案。方案一和方案二是从技术细节出发，大概描述了个人理解的管理思路和告警通知、告警自愈的方面来回答。而方案三和方案四是从宏观架构出发，主要都是想把服务器做成资源成的形式，提高服务器的可用性同时也提高应用服务的可用性。


### 方案一

部署堡垒机，然后把服务器按照部署的应用功能进行主机分类，利用Ansible Playbook的方式进行批量操作。发布迭代应用可以通过编写Python工具，读取配置文件调用Jenkins Pipeline进行流水线发布，并且根据Ansible定义的Hosts主机组来发布到对应服务器中。如果是需要对系统进行升级，就可以直接编写Ansible Playbook的Role定义对应升级步骤操作，然后通过Ansible进行操作。监控方面我会使用Zabbix，部署Zabbix Agent端主动上报方式进行数据信息采集，告警方式可以通过企业微信、钉钉的方式进行通知，而且根据实际场景需要开发对应的监控插件，符合当前的监控要求。关于服务器告警自愈的话，该方案可以根据Zabbix的告警信息触发对应的告警自愈脚本，然后也是通过堡垒机执行来尝试修复告警。



### 方案二

建立CMDB和运维平台，并且在服务器中部署管理的Agent端，在收集主机信息构建CMDB的同时，也是作为运维平台进行批量操作的接口。运维平台可以基于Python Flask、Django或者是Go的Gin和Vue前后端分离的方式进行构建，然后通过运维平台逻辑实现对服务器的日常操作，如果是云平台服务器还可以对接云平台的API构建属于自己的服务器管理平台，实现批量操作和信息结果的实时收集，Agent端也可以从运维平台中进行推送、迭代等操作。因为有Agent端的存在，可以自己定义收集的监控信息（如CPU、内存、磁盘空间、系统日志、进程信息、端口信息等），相当于是自定义Exporter进行收集。监控收集和展示工具的话会使用Prometheus、Grafana，不过也是可以看实际情况，也可以把展示工具直接放在运维平台来统一管理。告警方面可以使用Prometheus的AlertManager，通知对应的企业沟通工具，同时也可以通过推送的方式通知运维平台，运维平台再根据告警类型通知Agent端进行对应操作（前提是Agent端需要知道对应场景的处理方案）来进行告警自愈机制，保障服务器在正常状态中运行。



### 方案三

假如这50台服务器是中高配的物理机，那么我会使用OpenStack或者ZStack等开源项目，把这类单台资源很多的服务器整合起来成为资源池，通过创建虚拟机，管理虚拟机这种方式来使用服务器资源，这样可以把服务器的资源最大化利用的同时也可以做到环境隔离，一台服务器中可以部署不同类型的应用，而且应用出现问题的话也不会影响到其他应用。如果是物理机层面的问题，由于已经做好了资源池的操作，所以应用迁移或者应用本来高可用也是比较方便实现。至于应用监控方面和告警自愈也是类似前两个方案的做法。


### 方案四

如果50台服务器是配置一般的虚拟机，那么我会把这些节点按照实际情况尽可能做成Kubernetes集群。首先通过容器化也可以做到应用环境的隔离，然后也是通过Kubernetes的容器化编排，可以做到应用的高可用和方便迁移的功能，可以进一步加快运维操作的效率。然后关于节点管理、告警监控、告警自愈，就可以使用方案一或者方案二的做法。



